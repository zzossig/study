# Why is Concurrency Hard

## Race Condition

Race Condition은 기본적으로 프로그래머가 비동기(go routines) 코드를 sequantial하게, 즉 기존 동기 코드처럼 순차적으로 코드가 실행 될 것이라고 착각하기 때문에 발생한다.
비동기적 코드는 데이터가 조작되는 순서를 확정할 수 없기 때문에 코드에 비동기적 처리를 해야 예측 가능하게 된다.

## Automicity

원자성은 데이터가 처리되는 `Context` 내에서 그 데이터를 `동시에` 건드릴 수 없어야 한다는 것이다. 건드릴 수 없다는 말은 데이터를 읽거나(read) 쓰거나(write) 할 수 없어야 한다는 말이다.
즉, 하나의 프로세스가 그 데이터를 처리하는 동안, 다른 프로세스가 그 데이터를 보거나 방해할 수 없어야 한다.

## Memory Access Syncronization

사실 메모리 접근동기화도 원자성과 관련된 말이라고 생각한다. 원자성이라는 단어가 좀 더 추상화된 단어고, 원자성을 보장할 수 있는 하나의 방법이 메모리 접근을 동기화 하는 것이다(또 다른 방법으로는 share data through communication).
데이터를 비동기적으로 변경하게 되면, 변경된 데이터를 일반적인 프로그램의 흐름으로는 예측할 수 없다. 그래서 mutex를 이용하여 Lock, Unlock을 해가며 읽어야 변경된 데이터를 제대로 읽을 수 있다.
Go언어의 철학대로라면, 메모리 접근을 동기화하는 방법보다 channel을 이용하여(communication) 원자성을 확보하는게 더 나은 방법이다.

## Deadlock

데드락은 두개의 go routine이 서로 자원을 release하지 않기 때문에 발생한다. 프로세스1과 프로세스2가 서로가 Lock을 풀어주지 않기 때문에 프로그램의 동작이 멈추게 된다.
channel을 사용하면서 데드락이 발생하는 경우는, send(chan<-)해줄 channel이 존재하지 않는데(이미 끝났는데) receive(<-chan)를 계속 하는 경우다(vice versa).

## Livelock

Livelock은 프로그램에서 concurrent 작업을 수행하는데, 작업이 진행되지 않는것 처럼 보이는 것을 말한다.
Livelock이 발생하는 경우는 두개 이상의 concurrent 프로세스가 데드락을 피하기 위한 코드를 각자 독립적으로 구현해 놓았을 때, 데드락을 피하기 위한 프로세스간의 코드가 잘 조화가 안되어 발생하게 된다.
Livelock이 발생하면 코드가 돌아가는 것 처럼 보이지만, 실제로 원하는 결과값을 도출하는게 아닌, 중간 과정의 결과값만 멤돌게 되는 것이다.

## Starvation

Starvation은 concurrent 프로세스 작업을 수행하는데 필요한 자원을 온전히 쓸 수 없을 때 발생한다. Starvation이라는 말에 서 암시하듯, 자원에 굶주린다는 말이다. 자원은 cpu, 메모리, 파일 입출력, 네트워크 연결, 데이터베이스 연결 등을 할 때 수반되는 것을 말한다.
Starvation이 발생하면, 비동기 프로세스가 비효율적으로 수행될 뿐 아니라 결과가 부정확해 질 수도 있다. 어느 한 비동기 프로세스가 자원을 너무 많이 먹어서 다른 비동기 프로세스가 작업을 수행할 수 없는 지경에 이르면 당연히 원하는 결과를 얻을 수 없을 것이다.

## Determining Concurrency Safety

Concurrent 코드를 짜는건 사람이다. 당연한 말이다. (거의) 모든 코드 뒤에는 사람이 있다. 그래서 concurrent 코드를 읽을 때, 그 코드를 어떻게 설계하느냐가 중요하다.
우선 비동기 코드를 볼 때, 그 비동기성을 시작하고 끝낼 책임의 범위가 어느정도가 될지 설정하는게 중요하다(그래야 자원이 낭비되지 않고, 예측 가능한 코드를 짤 수 있다). 
또한 함수가 비동기 코드를 작동시킬 때, 이 코드가 비동기적 수행을 하는건지 안하는건지 등도 판단해야 한다.
결론부터 말하면 Go community에서 제시하는 여러 cocurrency pattern들을 따르면 safty와 simplicity, 가독성등을 획득할 수 있다(물론 Go니까 이걸 가능하게 한다).
